<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Users - ABCD2</title>
    <link rel="stylesheet" href="../css/style.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
  </head>
  <body>
    <header class="topbar">
      <div class="topbar-left">
        <div class="logo"><a href="../../index.html">ABCD</a></div>
        <button class="hamburger" id="hamburger">
          <img src="../icons/bars-solid.png" alt="bar.png" />
        </button>
      </div>
      <div class="topbar-right">
        <div class="search-container" id="searchBox" role="search">
          <input
            type="text"
            placeholder="Search the application..."
            aria-label="Search the application"
          />
          <div class="search-icon-container">
            <button
              type="button"
              id="searchToggle"
              class="material-icons search-icon"
            >
              search
            </button>
          </div>
        </div>
      </div>
    </header>

    <div class="container">
      <nav class="sidebar" id="sidebar" aria-label="Main navigation">
        <div class="menu">
          <div class="menu-item">
            <a href="../pages/users.html">
              <span class="material-icons" aria-hidden="true">person</span>
              User
            </a>
          </div>
          <div class="menu-item has-submenu">
            <a href="javascript:void(0)" class="submenu-toggle">
              <span class="material-icons" aria-hidden="true">inventory_2</span>
              Inventory
            </a>
            <div class="submenu">
              <a href="../pages/inventory.html">Inventory Items</a>
              <a href="../pages/accessories.html">Accessories</a>
              <a href="../pages/peripherals.html">Peripherals</a>
            </div>
          </div>
          <div class="menu-item">
            <a href="../pages/issueitem.html">
              <span class="material-icons" aria-hidden="true">
                assignment_returned
              </span>
              Issue To
            </a>
          </div>
          <div class="menu-item">
            <a href="../pages/repair.html">
              <span class="material-icons" aria-hidden="true">build</span>
              Repair
            </a>
          </div>
          <div class="menu-item">
            <a href="../pages/upgrade.html">
              <span class="material-icons" aria-hidden="true">upgrade</span>
              Upgrade
            </a>
          </div>
          <div class="menu-item">
            <a href="../pages/report.html">
              <span class="material-icons" aria-hidden="true">bar_chart</span>
              Reports
            </a>
          </div>
        </div>
        <div class="sidebar-footer">
          <span class="material-icons" aria-hidden="true">account_circle</span>
          <span>Logged User</span>
        </div>
      </nav>

      <main class="main" id="main-content">
        <div class="action-btn box-shadow">
          <div class="action-controls">
            <div class="filter action-controls">
              <button class="btn filter-btn" data-target-table="userTableBody" id="filterBtn">
                Filter
              </button>
            </div>
            <div class="content-search">
              <form class="search-form">
                <div class="search-content">
                  <input type="text" placeholder="Search..." />
                </div>
              </form>
            </div>
          </div>
          <div class="action-controls">
            <button class="btn add-btn" onclick="location.href='add-user.html'">
              Add User
            </button>
            <button class="btn dis-btn">Disable</button>
          </div>
        </div>

        <!-- Filter Inputs -->
        <div class="filter-controls" id="filterControls" style="display:none; margin-bottom: 10px;">
          <input type="text" class="filter-input" data-column="2" placeholder="Full Name" />
          <select class="filter-input" data-column="4">
            <option value="">All Departments</option>
            <option value="IT">IT</option>
            <option value="Finance">Finance</option>
            <option value="Admin">Admin</option>
            <option value="Teaching">Teaching</option>
          </select>
          <select class="filter-input" data-column="7">
            <option value="">All Status</option>
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
          </select>
          <button id="applyFilter">Apply</button>
        </div>

        <div class="table-container">
          <table class="table accessories-table">
            <thead>
              <tr>
                <th><input type="checkbox" /></th>
                <th>User ID</th>
                <th>Full Name</th>
                <th>Designation</th>
                <th>Department</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Status</th>
                <th>Remarks</th>
              </tr>
            </thead>
            <tbody id="userTableBody">
              <!-- Fetch from DataBase -->
            </tbody>
          </table>
        </div>
      </main>
    </div>

    <script src="../js/script.js"></script>
    <script src="../js/config.js"></script>

    <!-- Reusable Filter JS -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const filterBtn = document.getElementById("filterBtn");
        const filterControls = document.getElementById("filterControls");
        const applyBtn = document.getElementById("applyFilter");
        const tableBody = document.getElementById("userTableBody");

        filterBtn.addEventListener("click", () => {
          filterControls.style.display =
            filterControls.style.display === "none" ? "block" : "none";
        });

        applyBtn.addEventListener("click", () => {
          const inputs = filterControls.querySelectorAll(".filter-input");
          const rows = tableBody.getElementsByTagName("tr");

          for (let row of rows) {
            let show = true;

            inputs.forEach((input) => {
              const colIndex = parseInt(input.dataset.column);
              const value = input.value.toLowerCase();
              const cellText = row.cells[colIndex].textContent.toLowerCase();
              if (value && !cellText.includes(value)) show = false;
            });

            row.style.display = show ? "" : "none";
          }
        });
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        fetchUsers();
      });

      async function fetchUsers() {
        try {
          const response = await fetch(`${BASE_URL}/api/users`);
          const users = await response.json();

          const tableBody = document.getElementById("userTableBody");
          tableBody.innerHTML = "";

          users.forEach((user) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td><input type="checkbox" /></td>
              <td>${user.userId}</td>
              <td>${user.fullName}</td>
              <td>${user.designation || "-"}</td>
              <td>${user.department || "-"}</td>
              <td>${user.email}</td>
              <td>${user.phone || "-"}</td>
              <td>${user.status}</td>
              <td>${user.remarks || "-"}</td>
            `;
            tableBody.appendChild(row);
          });
        } catch (error) {
          console.error("Error loading users:", error);
        }
      }

      const filterBtn = document.getElementById("filterBtn");
  const filterControls = document.getElementById("filterControls");
  const applyBtn = document.getElementById("applyFilter");
  const tableBody = document.getElementById("userTableBody");

  // Show/hide filter inputs
  filterBtn.addEventListener("click", () => {
    if (!filterControls) return;
    filterControls.style.display = filterControls.style.display === "none" ? "block" : "none";
  });

  // Apply filters
  applyBtn.addEventListener("click", () => {
    const inputs = filterControls.querySelectorAll(".filter-input");
    const rows = tableBody.getElementsByTagName("tr");

    for (let row of rows) {
      let show = true;

      inputs.forEach((input) => {
        const colIndex = parseInt(input.dataset.column);
        const value = input.value.toLowerCase().trim();
        const cellText = row.cells[colIndex].textContent.toLowerCase().trim();
        if (value && !cellText.includes(value)) show = false;
      });

      row.style.display = show ? "" : "none";
    }
  });
    </script>
  </body>
</html>
